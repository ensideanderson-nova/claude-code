<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Integrado - Enside Madeiras | Produ√ß√£o + Frete + Cota√ß√£o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --enside-green: #2c5c34;
            --enside-green-light: #3d7a47;
            --enside-green-dark: #1e4024;
            --success: #4caf50;
            --warning: #ffc107;
            --danger: #f44336;
            --info: #2196F3;
            --bg-light: #f5f9fc;
            --bg-green-light: #e8f5e9;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-green-light) 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* HEADER */
        .main-header {
            background: linear-gradient(135deg, var(--enside-green) 0%, var(--enside-green-light) 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(44, 92, 52, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
        }

        .header-subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .header-brand {
            text-align: right;
        }

        .brand-logo {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .brand-tagline {
            opacity: 0.9;
            font-size: 0.95em;
        }

        /* NAVIGATION TABS */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: var(--bg-light);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            text-align: center;
        }

        .nav-tab:hover {
            background: var(--bg-green-light);
            border-color: var(--enside-green);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--enside-green) 0%, var(--enside-green-light) 100%);
            color: white;
            border-color: var(--enside-green-dark);
            box-shadow: 0 4px 12px rgba(44, 92, 52, 0.3);
        }

        .tab-icon {
            display: block;
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        /* TAB CONTENT */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* PANELS */
        .panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--bg-green-light);
        }

        .panel-title {
            color: var(--enside-green);
            font-size: 1.5em;
            font-weight: 600;
        }

        .panel-badge {
            background: var(--enside-green);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        /* ALERTS */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            border-left-color: var(--success);
            color: #155724;
        }

        .alert-info {
            background: #d1ecf1;
            border-left-color: var(--info);
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border-left-color: var(--warning);
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-left-color: var(--danger);
            color: #721c24;
        }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--enside-green) 0%, var(--enside-green-light) 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(44, 92, 52, 0.3);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .stat-card.secondary {
            background: linear-gradient(135deg, #666 0%, #555 100%);
        }

        .stat-card.success {
            background: linear-gradient(135deg, var(--success) 0%, #45a049 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #ffa000 100%);
        }

        /* FORM ELEMENTS */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            color: var(--enside-green);
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-input,
        .form-select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--enside-green);
            box-shadow: 0 0 0 3px rgba(44, 92, 52, 0.1);
        }

        /* TABLES */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--enside-green) 0%, var(--enside-green-light) 100%);
            color: white;
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table tbody tr:hover {
            background: var(--bg-green-light);
        }

        .data-table .total-row {
            background: var(--bg-green-light);
            font-weight: bold;
            font-size: 1.1em;
        }

        .data-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* BUTTONS */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--enside-green) 0%, var(--enside-green-light) 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #45a049 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #da190b 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #666 0%, #555 100%);
            color: white;
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* RESULT PANELS */
        .result-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: 2px solid var(--enside-green);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .result-header {
            color: var(--enside-green);
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--bg-green-light);
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid var(--enside-green);
        }

        .result-label {
            color: #666;
            font-weight: 500;
        }

        .result-value {
            color: var(--enside-green);
            font-weight: bold;
            font-size: 1.1em;
        }

        .result-highlight {
            background: linear-gradient(135deg, var(--enside-green) 0%, var(--enside-green-light) 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(44, 92, 52, 0.3);
        }

        /* PROPOSAL SECTION */
        .proposal-section {
            background: white;
            border: 3px solid var(--enside-green);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
        }

        .proposal-header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--bg-green-light);
            margin-bottom: 25px;
        }

        .proposal-title {
            color: var(--enside-green);
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .proposal-subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .proposal-body {
            line-height: 1.8;
        }

        .proposal-section-title {
            color: var(--enside-green);
            font-size: 1.3em;
            font-weight: 600;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--bg-green-light);
        }

        .proposal-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--bg-green-light);
            text-align: center;
            color: #666;
        }

        /* FLOW DIAGRAM */
        .flow-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 12px;
        }

        .flow-step {
            flex: 1;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid var(--enside-green);
            position: relative;
        }

        .flow-step::after {
            content: '‚Üí';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
            color: var(--enside-green);
        }

        .flow-step:last-child::after {
            display: none;
        }

        .flow-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .flow-label {
            font-weight: 600;
            color: var(--enside-green);
            margin-bottom: 5px;
        }

        .flow-value {
            font-size: 1.2em;
            font-weight: bold;
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .flow-diagram {
                flex-direction: column;
                gap: 20px;
            }

            .flow-step::after {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .header-brand {
                text-align: center;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media print {
            body {
                background: white;
            }

            .nav-tabs,
            .btn-group,
            .btn {
                display: none !important;
            }

            .panel {
                box-shadow: none;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="main-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>üå≤ Sistema Integrado de Cota√ß√£o</h1>
                    <div class="header-subtitle">Produ√ß√£o + Frete + Margem = Proposta Completa</div>
                </div>
                <div class="header-brand">
                    <div class="brand-logo">ENSIDE MADEIRAS</div>
                    <div class="brand-tagline">Grupo L√≠der | Excel√™ncia em Madeira</div>
                </div>
            </div>
        </div>

        <!-- NAVIGATION -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">
                <span class="tab-icon">üìä</span>
                Dashboard
            </button>
            <button class="nav-tab" onclick="switchTab('producao')">
                <span class="tab-icon">üå≤</span>
                Produ√ß√£o
            </button>
            <button class="nav-tab" onclick="switchTab('frete')">
                <span class="tab-icon">üöö</span>
                Frete
            </button>
            <button class="nav-tab" onclick="switchTab('cotacao')">
                <span class="tab-icon">üí∞</span>
                Cota√ß√£o Final
            </button>
            <button class="nav-tab" onclick="switchTab('proposta')">
                <span class="tab-icon">üìÑ</span>
                Proposta
            </button>
        </div>

        <!-- TAB: DASHBOARD -->
        <div id="tab-dashboard" class="tab-content active">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìä Dashboard Geral</h2>
                    <span class="panel-badge">Tempo Real</span>
                </div>

                <div class="alert alert-success">
                    <span style="font-size: 1.5em;">‚úÖ</span>
                    <div>
                        <strong>Sistema Integrado Ativo!</strong>
                        <div>Todos os m√≥dulos funcionando e sincronizados.</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">R$ <span id="dash-custo-producao">115.36</span></div>
                        <div class="stat-label">Custo Produ√ß√£o/m¬≥</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-value">R$ <span id="dash-custo-frete">85.00</span></div>
                        <div class="stat-label">Custo Frete/m¬≥</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-value">R$ <span id="dash-custo-total">200.36</span></div>
                        <div class="stat-label">Custo Total/m¬≥</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value">R$ <span id="dash-preco-venda">320.58</span></div>
                        <div class="stat-label">Pre√ßo Venda/m¬≥</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value"><span id="dash-margem">37.5</span>%</div>
                        <div class="stat-label">Margem de Lucro</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-value">R$ <span id="dash-lucro">12,022</span></div>
                        <div class="stat-label">Lucro (100m¬≥)</div>
                    </div>
                </div>

                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="flow-icon">üå≤</div>
                        <div class="flow-label">Produ√ß√£o</div>
                        <div class="flow-value">R$ <span id="flow-producao">115.36</span>/m¬≥</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-icon">üöö</div>
                        <div class="flow-label">Frete</div>
                        <div class="flow-value">R$ <span id="flow-frete">85.00</span>/m¬≥</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-icon">üí∞</div>
                        <div class="flow-label">Margem</div>
                        <div class="flow-value"><span id="flow-margem">37.5</span>%</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-icon">üìä</div>
                        <div class="flow-label">Venda</div>
                        <div class="flow-value">R$ <span id="flow-venda">320.58</span>/m¬≥</div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <span style="font-size: 1.5em;">üí°</span>
                    <div>
                        <strong>Como usar o sistema:</strong>
                        <ol style="margin: 10px 0 0 20px; line-height: 1.8;">
                            <li>Configure os <strong>custos de produ√ß√£o</strong> na aba "Produ√ß√£o"</li>
                            <li>Calcule o <strong>frete</strong> na aba "Frete" (origem ‚Üí destino)</li>
                            <li>Defina sua <strong>margem</strong> na aba "Cota√ß√£o Final"</li>
                            <li>Gere a <strong>proposta comercial</strong> pronta para enviar ao cliente</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: PRODU√á√ÉO -->
        <div id="tab-producao" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üå≤ Custos de Produ√ß√£o</h2>
                    <span class="panel-badge">Eucalipto</span>
                </div>

                <div class="alert alert-info">
                    <span style="font-size: 1.5em;">‚ÑπÔ∏è</span>
                    <div>Configure os custos de corte, processamento e carregamento. Os valores ser√£o usados automaticamente na cota√ß√£o final.</div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Volume Total (m¬≥):</label>
                        <input type="number" id="prod-volume" class="form-input" value="100" min="1" onchange="calcularProducao()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Regi√£o de Produ√ß√£o:</label>
                        <select id="prod-regiao" class="form-select" onchange="aplicarPresetRegiao()">
                            <option value="paraibuna">Paraibuna (SP/MG)</option>
                            <option value="norte-pr">Norte do Paran√°</option>
                            <option value="sc">Santa Catarina</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Madeira:</label>
                        <select id="prod-tipo" class="form-select" onchange="calcularProducao()">
                            <option value="eucalipto">Eucalipto</option>
                            <option value="pinus">Pinus</option>
                            <option value="mista">Mista</option>
                        </select>
                    </div>
                </div>

                <h3 style="color: var(--enside-green); margin: 25px 0 15px 0;">üìã Composi√ß√£o de Custos</h3>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Categoria</th>
                            <th width="150px">Valor/m¬≥</th>
                            <th width="150px">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>üîµ Planejamento e Licenciamento</td>
                            <td><input type="number" id="prod-planejamento" value="30.00" step="0.01" onchange="calcularProducao()"></td>
                            <td><span id="prod-planejamento-total">3000.00</span></td>
                        </tr>
                        <tr>
                            <td>üü¢ Corte e Processamento</td>
                            <td><input type="number" id="prod-corte" value="38.00" step="0.01" onchange="calcularProducao()"></td>
                            <td><span id="prod-corte-total">3800.00</span></td>
                        </tr>
                        <tr>
                            <td>üü° Transporte Interno (Arraste)</td>
                            <td><input type="number" id="prod-transporte" value="32.40" step="0.01" onchange="calcularProducao()"></td>
                            <td><span id="prod-transporte-total">3240.00</span></td>
                        </tr>
                        <tr>
                            <td>üü† Carregamento</td>
                            <td><input type="number" id="prod-carregamento" value="14.96" step="0.01" onchange="calcularProducao()"></td>
                            <td><span id="prod-carregamento-total">1496.00</span></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>CUSTO TOTAL DE PRODU√á√ÉO</strong></td>
                            <td><strong>R$ <span id="prod-custo-m3">115.36</span></strong></td>
                            <td><strong>R$ <span id="prod-custo-total">11536.00</span></strong></td>
                        </tr>
                    </tbody>
                </table>

                <div class="result-panel">
                    <div class="result-header">üìä Economia de Escala</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <span class="result-label">50 m¬≥:</span>
                            <span class="result-value">R$ <span id="prod-scale-50">145.72</span>/m¬≥</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">100 m¬≥:</span>
                            <span class="result-value">R$ <span id="prod-scale-100">115.36</span>/m¬≥</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">200 m¬≥:</span>
                            <span class="result-value">R$ <span id="prod-scale-200">100.18</span>/m¬≥</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">500 m¬≥:</span>
                            <span class="result-value">R$ <span id="prod-scale-500">91.27</span>/m¬≥</span>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="salvarProducao()">üíæ Salvar Configura√ß√£o</button>
                    <button class="btn btn-secondary" onclick="carregarProducao()">üìÇ Carregar Salva</button>
                    <button class="btn btn-success" onclick="switchTab('frete')">Pr√≥ximo: Calcular Frete ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- TAB: FRETE -->
        <div id="tab-frete" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üöö C√°lculo de Frete</h2>
                    <span class="panel-badge">Rodovi√°rio</span>
                </div>

                <div class="alert alert-warning">
                    <span style="font-size: 1.5em;">‚ö†Ô∏è</span>
                    <div>
                        <strong>Importante:</strong> Os valores de frete s√£o referenciais. Consulte sempre transportadoras parceiras para cota√ß√£o precisa.
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Origem (Produ√ß√£o):</label>
                        <select id="frete-origem" class="form-select" onchange="calcularFrete()">
                            <option value="paraibuna-sp">Paraibuna (SP)</option>
                            <option value="norte-pr">Norte do Paran√°</option>
                            <option value="oeste-sc">Oeste de Santa Catarina</option>
                            <option value="custom">Outro...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Destino (Cliente):</label>
                        <select id="frete-destino" class="form-select" onchange="calcularFrete()">
                            <option value="sao-paulo-sp">S√£o Paulo Capital</option>
                            <option value="campinas-sp">Campinas (SP)</option>
                            <option value="rio-rj">Rio de Janeiro (RJ)</option>
                            <option value="curitiba-pr">Curitiba (PR)</option>
                            <option value="belo-horizonte-mg">Belo Horizonte (MG)</option>
                            <option value="custom">Outro...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dist√¢ncia (km):</label>
                        <input type="number" id="frete-distancia" class="form-input" value="150" min="1" onchange="calcularFrete()">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Volume (m¬≥):</label>
                        <input type="number" id="frete-volume" class="form-input" value="100" min="1" onchange="calcularFrete()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Caminh√£o:</label>
                        <select id="frete-caminhao" class="form-select" onchange="calcularFrete()">
                            <option value="truck">Truck (14m¬≥)</option>
                            <option value="carreta">Carreta (28m¬≥)</option>
                            <option value="bitrem">Bitrem (45m¬≥)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Custo Base (R$/km):</label>
                        <input type="number" id="frete-custo-km" class="form-input" value="4.50" step="0.10" onchange="calcularFrete()">
                    </div>
                </div>

                <h3 style="color: var(--enside-green); margin: 25px 0 15px 0;">üìä Detalhamento do Frete</h3>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th width="200px">Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Dist√¢ncia Total</td>
                            <td><span id="frete-dist-display">150</span> km</td>
                        </tr>
                        <tr>
                            <td>N√∫mero de Viagens</td>
                            <td><span id="frete-num-viagens">4</span> viagens</td>
                        </tr>
                        <tr>
                            <td>Custo por Viagem</td>
                            <td>R$ <span id="frete-custo-viagem">675.00</span></td>
                        </tr>
                        <tr>
                            <td>Ped√°gios (estimado)</td>
                            <td>R$ <span id="frete-pedagios">150.00</span></td>
                        </tr>
                        <tr>
                            <td>Seguro de Carga (2%)</td>
                            <td>R$ <span id="frete-seguro">54.00</span></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>CUSTO TOTAL DE FRETE</strong></td>
                            <td><strong>R$ <span id="frete-total">8500.00</span></strong></td>
                        </tr>
                        <tr class="total-row" style="background: #e8f5e9;">
                            <td><strong>CUSTO POR M¬≥</strong></td>
                            <td><strong>R$ <span id="frete-custo-m3">85.00</span></strong></td>
                        </tr>
                    </tbody>
                </table>

                <div class="result-panel">
                    <div class="result-header">üó∫Ô∏è An√°lise de Rota</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <span class="result-label">Tempo Estimado:</span>
                            <span class="result-value"><span id="frete-tempo">3h 30min</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Consumo Diesel:</span>
                            <span class="result-value"><span id="frete-diesel">60</span> litros</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Custo Diesel:</span>
                            <span class="result-value">R$ <span id="frete-custo-diesel">372.00</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Efici√™ncia:</span>
                            <span class="result-value"><span id="frete-eficiencia">2.5</span> km/L</span>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="salvarFrete()">üíæ Salvar C√°lculo</button>
                    <button class="btn btn-secondary" onclick="buscarMotoristasMILER()">üöö Buscar Motoristas MILER</button>
                    <button class="btn btn-success" onclick="switchTab('cotacao')">Pr√≥ximo: Cota√ß√£o Final ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- TAB: COTA√á√ÉO FINAL -->
        <div id="tab-cotacao" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üí∞ Cota√ß√£o Final Integrada</h2>
                    <span class="panel-badge">Pre√ßo Completo</span>
                </div>

                <div class="alert alert-success">
                    <span style="font-size: 1.5em;">‚úÖ</span>
                    <div>
                        <strong>Integra√ß√£o Completa:</strong> Custos de produ√ß√£o e frete j√° calculados e integrados automaticamente.
                    </div>
                </div>

                <h3 style="color: var(--enside-green); margin: 25px 0 15px 0;">üìä Resumo de Custos Base</h3>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Componente</th>
                            <th width="150px">Valor/m¬≥</th>
                            <th width="150px">% do Total</th>
                            <th width="150px">Total (<span id="cot-volume-display">100</span>m¬≥)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>üå≤ Custo de Produ√ß√£o</td>
                            <td>R$ <span id="cot-prod-m3">115.36</span></td>
                            <td><span id="cot-prod-percent">57.6%</span></td>
                            <td>R$ <span id="cot-prod-total">11536.00</span></td>
                        </tr>
                        <tr>
                            <td>üöö Custo de Frete</td>
                            <td>R$ <span id="cot-frete-m3">85.00</span></td>
                            <td><span id="cot-frete-percent">42.4%</span></td>
                            <td>R$ <span id="cot-frete-total">8500.00</span></td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>CUSTO BASE TOTAL</strong></td>
                            <td><strong>R$ <span id="cot-base-m3">200.36</span></strong></td>
                            <td><strong>100%</strong></td>
                            <td><strong>R$ <span id="cot-base-total">20036.00</span></strong></td>
                        </tr>
                    </tbody>
                </table>

                <h3 style="color: var(--enside-green); margin: 35px 0 15px 0;">‚öôÔ∏è Configura√ß√£o de Margens e Impostos</h3>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Custos Administrativos (%):</label>
                        <input type="number" id="cot-admin" class="form-input" value="8" min="0" max="100" step="0.5" onchange="calcularCotacaoFinal()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Impostos (%):</label>
                        <input type="number" id="cot-impostos" class="form-input" value="13.33" min="0" max="100" step="0.1" onchange="calcularCotacaoFinal()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Margem de Lucro Desejada (%):</label>
                        <input type="number" id="cot-margem" class="form-input" value="30" min="0" max="100" step="1" onchange="calcularCotacaoFinal()">
                    </div>
                </div>

                <h3 style="color: var(--enside-green); margin: 35px 0 15px 0;">üíµ Forma√ß√£o do Pre√ßo de Venda</h3>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Componente</th>
                            <th width="150px">Valor/m¬≥</th>
                            <th width="150px">% do Pre√ßo</th>
                            <th width="150px">Total (<span id="cot-volume-display2">100</span>m¬≥)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Custo Base (Produ√ß√£o + Frete)</td>
                            <td>R$ <span id="cot-final-base-m3">200.36</span></td>
                            <td><span id="cot-final-base-percent">62.5%</span></td>
                            <td>R$ <span id="cot-final-base-total">20036.00</span></td>
                        </tr>
                        <tr>
                            <td>+ Custos Administrativos</td>
                            <td>R$ <span id="cot-final-admin-m3">16.03</span></td>
                            <td><span id="cot-final-admin-percent">5.0%</span></td>
                            <td>R$ <span id="cot-final-admin-total">1602.88</span></td>
                        </tr>
                        <tr>
                            <td>+ Impostos</td>
                            <td>R$ <span id="cot-final-imp-m3">26.71</span></td>
                            <td><span id="cot-final-imp-percent">8.3%</span></td>
                            <td>R$ <span id="cot-final-imp-total">2670.80</span></td>
                        </tr>
                        <tr>
                            <td>+ Margem de Lucro</td>
                            <td>R$ <span id="cot-final-lucro-m3">72.93</span></td>
                            <td><span id="cot-final-lucro-percent">22.7%</span></td>
                            <td>R$ <span id="cot-final-lucro-total">7293.00</span></td>
                        </tr>
                        <tr class="total-row" style="background: linear-gradient(135deg, var(--enside-green) 0%, var(--enside-green-light) 100%); color: white;">
                            <td><strong>üí∞ PRE√áO DE VENDA FINAL</strong></td>
                            <td><strong>R$ <span id="cot-final-preco-m3">320.58</span></strong></td>
                            <td><strong>100%</strong></td>
                            <td><strong>R$ <span id="cot-final-preco-total">32058.00</span></strong></td>
                        </tr>
                    </tbody>
                </table>

                <div class="result-highlight">
                    PRE√áO FINAL: R$ <span id="cot-destaque-preco">320.58</span>/m¬≥ |
                    TOTAL: R$ <span id="cot-destaque-total">32,058.00</span> (<span id="cot-destaque-volume">100</span>m¬≥) |
                    LUCRO: R$ <span id="cot-destaque-lucro">7,293.00</span>
                </div>

                <div class="result-panel">
                    <div class="result-header">üìà Indicadores Financeiros</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <span class="result-label">Markup:</span>
                            <span class="result-value"><span id="cot-markup">1.60</span>x</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Margem Bruta:</span>
                            <span class="result-value"><span id="cot-margem-bruta">37.5</span>%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Lucro/m¬≥:</span>
                            <span class="result-value">R$ <span id="cot-lucro-m3">72.93</span></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Break-even:</span>
                            <span class="result-value"><span id="cot-breakeven">48</span> m¬≥</span>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="salvarCotacao()">üíæ Salvar Cota√ß√£o</button>
                    <button class="btn btn-secondary" onclick="exportarCotacaoCSV()">üìä Exportar CSV</button>
                    <button class="btn btn-success" onclick="switchTab('proposta')">Pr√≥ximo: Gerar Proposta ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- TAB: PROPOSTA -->
        <div id="tab-proposta" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìÑ Proposta Comercial</h2>
                    <span class="panel-badge">Pronta para Cliente</span>
                </div>

                <div class="alert alert-info">
                    <span style="font-size: 1.5em;">üí°</span>
                    <div>
                        <strong>Personalize sua proposta:</strong> Preencha os dados do cliente e ajuste o texto conforme necess√°rio antes de enviar.
                    </div>
                </div>

                <h3 style="color: var(--enside-green); margin: 25px 0 15px 0;">üë§ Dados do Cliente</h3>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nome do Cliente:</label>
                        <input type="text" id="prop-cliente-nome" class="form-input" placeholder="Raz√£o Social ou Nome">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contato:</label>
                        <input type="text" id="prop-cliente-contato" class="form-input" placeholder="Nome do contato">
                    </div>
                    <div class="form-group">
                        <label class="form-label">E-mail:</label>
                        <input type="email" id="prop-cliente-email" class="form-input" placeholder="contato@empresa.com">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Telefone:</label>
                        <input type="tel" id="prop-cliente-telefone" class="form-input" placeholder="(00) 0000-0000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cidade:</label>
                        <input type="text" id="prop-cliente-cidade" class="form-input" placeholder="Cidade - UF">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Validade da Proposta (dias):</label>
                        <input type="number" id="prop-validade" class="form-input" value="15" min="1">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="gerarProposta()" style="margin: 20px 0;">üìÑ Gerar Proposta</button>

                <div id="proposta-container" class="proposal-section" style="display: none;">
                    <div class="proposal-header">
                        <div class="proposal-title">PROPOSTA COMERCIAL</div>
                        <div class="proposal-subtitle">Fornecimento de Madeira de Eucalipto</div>
                        <div style="margin-top: 15px; color: #666;">
                            Proposta N¬∫: <strong><span id="prop-numero">2024-001</span></strong> |
                            Data: <strong><span id="prop-data">16/12/2024</span></strong>
                        </div>
                    </div>

                    <div class="proposal-body">
                        <div class="proposal-section-title">1. DADOS DO CLIENTE</div>
                        <p><strong>Cliente:</strong> <span id="prop-display-cliente">-</span></p>
                        <p><strong>Contato:</strong> <span id="prop-display-contato">-</span></p>
                        <p><strong>E-mail:</strong> <span id="prop-display-email">-</span></p>
                        <p><strong>Telefone:</strong> <span id="prop-display-telefone">-</span></p>
                        <p><strong>Localiza√ß√£o:</strong> <span id="prop-display-cidade">-</span></p>

                        <div class="proposal-section-title">2. ESPECIFICA√á√ïES DO PRODUTO</div>
                        <p><strong>Produto:</strong> Toras de Eucalipto</p>
                        <p><strong>Volume:</strong> <span id="prop-display-volume">100</span> m¬≥</p>
                        <p><strong>Origem:</strong> <span id="prop-display-origem">Paraibuna (SP/MG)</span></p>
                        <p><strong>Destino:</strong> <span id="prop-display-destino">S√£o Paulo Capital</span></p>
                        <p><strong>Prazo de Entrega:</strong> 15 a 20 dias √∫teis ap√≥s confirma√ß√£o do pedido</p>

                        <div class="proposal-section-title">3. VALORES E CONDI√á√ïES</div>

                        <table class="data-table" style="margin-top: 15px;">
                            <thead>
                                <tr>
                                    <th>Descri√ß√£o</th>
                                    <th width="150px">Valor/m¬≥</th>
                                    <th width="150px">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Custo de Produ√ß√£o</td>
                                    <td>R$ <span id="prop-table-prod">115.36</span></td>
                                    <td>R$ <span id="prop-table-prod-total">11,536.00</span></td>
                                </tr>
                                <tr>
                                    <td>Frete (Origem ‚Üí Destino)</td>
                                    <td>R$ <span id="prop-table-frete">85.00</span></td>
                                    <td>R$ <span id="prop-table-frete-total">8,500.00</span></td>
                                </tr>
                                <tr>
                                    <td>Custos Administrativos e Impostos</td>
                                    <td>R$ <span id="prop-table-admin">42.74</span></td>
                                    <td>R$ <span id="prop-table-admin-total">4,274.00</span></td>
                                </tr>
                                <tr class="total-row" style="background: linear-gradient(135deg, var(--enside-green) 0%, var(--enside-green-light) 100%); color: white;">
                                    <td><strong>VALOR TOTAL DA PROPOSTA</strong></td>
                                    <td><strong>R$ <span id="prop-table-final">320.58</span></strong></td>
                                    <td><strong>R$ <span id="prop-table-final-total">32,058.00</span></strong></td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="proposal-section-title">4. CONDI√á√ïES DE PAGAMENTO</div>
                        <ul style="line-height: 2;">
                            <li>‚úÖ <strong>Entrada:</strong> 30% na confirma√ß√£o do pedido</li>
                            <li>‚úÖ <strong>Entrega:</strong> 40% no carregamento</li>
                            <li>‚úÖ <strong>Final:</strong> 30% ap√≥s descarga no destino</li>
                        </ul>

                        <div class="proposal-section-title">5. INFORMA√á√ïES ADICIONAIS</div>
                        <ul style="line-height: 2;">
                            <li>üìã Todos os documentos fiscais e licen√ßas ambientais inclusos</li>
                            <li>‚úÖ Certificado de origem e qualidade da madeira</li>
                            <li>üöö Transporte com rastreamento em tempo real</li>
                            <li>üìû Suporte t√©cnico durante todo o processo</li>
                            <li>‚è±Ô∏è Validade da proposta: <strong><span id="prop-display-validade">15</span> dias</strong></li>
                        </ul>

                        <div class="proposal-section-title">6. CONTATO COMERCIAL</div>
                        <p><strong>Enside Madeiras - Grupo L√≠der</strong></p>
                        <p>üìß E-mail: comercial@ensidemadeiras.com.br</p>
                        <p>üì± WhatsApp: (18) 99654-0492</p>
                        <p>üåê Site: www.ensidemadeiras.com.br</p>
                        <p>üìç Ara√ßatuba - SP</p>
                    </div>

                    <div class="proposal-footer">
                        <p><strong>Anderson Enside</strong></p>
                        <p>CEO - Grupo L√≠der Madeiras</p>
                        <p style="margin-top: 20px; font-size: 0.9em;">Esta proposta √© v√°lida por <span id="prop-footer-validade">15</span> dias a partir da data de emiss√£o.</p>
                    </div>
                </div>

                <div class="btn-group" id="proposta-actions" style="display: none; margin-top: 20px;">
                    <button class="btn btn-success" onclick="imprimirProposta()">üñ®Ô∏è Imprimir Proposta</button>
                    <button class="btn btn-primary" onclick="gerarPropostaPDF()">üìÑ Gerar PDF</button>
                    <button class="btn btn-secondary" onclick="enviarPropostaEmail()">üìß Enviar por E-mail</button>
                    <button class="btn btn-primary" onclick="enviarPropostaWhatsApp()">üí¨ Enviar por WhatsApp</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =====================================
        // ESTADO GLOBAL DO SISTEMA
        // =====================================

        let sistemaState = {
            producao: {
                volume: 100,
                regiao: 'paraibuna',
                tipo: 'eucalipto',
                planejamento: 30.00,
                corte: 38.00,
                transporte: 32.40,
                carregamento: 14.96,
                custoTotal: 11536.00,
                custoM3: 115.36
            },
            frete: {
                origem: 'paraibuna-sp',
                destino: 'sao-paulo-sp',
                distancia: 150,
                volume: 100,
                caminhao: 'truck',
                custoKm: 4.50,
                custoTotal: 8500.00,
                custoM3: 85.00
            },
            cotacao: {
                admin: 8,
                impostos: 13.33,
                margem: 30,
                precoFinal: 320.58,
                precoTotal: 32058.00
            }
        };

        // =====================================
        // NAVEGA√á√ÉO ENTRE ABAS
        // =====================================

        function switchTab(tabName) {
            // Remover active de todas as abas
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Ativar aba selecionada
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');

            // Atualizar dados se necess√°rio
            if (tabName === 'cotacao') {
                sincronizarDadosCotacao();
                calcularCotacaoFinal();
            } else if (tabName === 'dashboard') {
                atualizarDashboard();
            }
        }

        // =====================================
        // C√ÅLCULOS DE PRODU√á√ÉO
        // =====================================

        function calcularProducao() {
            const volume = parseFloat(document.getElementById('prod-volume').value) || 100;
            const planejamento = parseFloat(document.getElementById('prod-planejamento').value) || 30;
            const corte = parseFloat(document.getElementById('prod-corte').value) || 38;
            const transporte = parseFloat(document.getElementById('prod-transporte').value) || 32.40;
            const carregamento = parseFloat(document.getElementById('prod-carregamento').value) || 14.96;

            // Totais
            const planejamentoTotal = planejamento * volume;
            const corteTotal = corte * volume;
            const transporteTotal = transporte * volume;
            const carregamentoTotal = carregamento * volume;
            const custoTotal = planejamentoTotal + corteTotal + transporteTotal + carregamentoTotal;
            const custoM3 = custoTotal / volume;

            // Atualizar interface
            document.getElementById('prod-planejamento-total').textContent = planejamentoTotal.toFixed(2);
            document.getElementById('prod-corte-total').textContent = corteTotal.toFixed(2);
            document.getElementById('prod-transporte-total').textContent = transporteTotal.toFixed(2);
            document.getElementById('prod-carregamento-total').textContent = carregamentoTotal.toFixed(2);
            document.getElementById('prod-custo-total').textContent = custoTotal.toFixed(2);
            document.getElementById('prod-custo-m3').textContent = custoM3.toFixed(2);

            // Economia de escala
            const custoVariavel = corte + transporte + carregamento;
            const custoFixo = planejamento;

            [50, 100, 200, 500].forEach(vol => {
                const totalCusto = (custoFixo * volume) + (custoVariavel * vol);
                const custoMedio = totalCusto / vol;
                document.getElementById('prod-scale-' + vol).textContent = custoMedio.toFixed(2);
            });

            // Salvar no estado
            sistemaState.producao.volume = volume;
            sistemaState.producao.planejamento = planejamento;
            sistemaState.producao.corte = corte;
            sistemaState.producao.transporte = transporte;
            sistemaState.producao.carregamento = carregamento;
            sistemaState.producao.custoTotal = custoTotal;
            sistemaState.producao.custoM3 = custoM3;

            atualizarDashboard();
        }

        function aplicarPresetRegiao() {
            const regiao = document.getElementById('prod-regiao').value;

            const presets = {
                'paraibuna': { planejamento: 30, corte: 38, transporte: 32.40, carregamento: 14.96 },
                'norte-pr': { planejamento: 28, corte: 35, transporte: 30, carregamento: 13.50 },
                'sc': { planejamento: 32, corte: 40, transporte: 35, carregamento: 15.80 }
            };

            if (presets[regiao]) {
                const preset = presets[regiao];
                document.getElementById('prod-planejamento').value = preset.planejamento;
                document.getElementById('prod-corte').value = preset.corte;
                document.getElementById('prod-transporte').value = preset.transporte;
                document.getElementById('prod-carregamento').value = preset.carregamento;
                calcularProducao();
            }
        }

        function salvarProducao() {
            localStorage.setItem('ensideProducao', JSON.stringify(sistemaState.producao));
            alert('‚úÖ Configura√ß√£o de produ√ß√£o salva com sucesso!');
        }

        function carregarProducao() {
            const saved = localStorage.getItem('ensideProducao');
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('prod-volume').value = data.volume;
                document.getElementById('prod-planejamento').value = data.planejamento;
                document.getElementById('prod-corte').value = data.corte;
                document.getElementById('prod-transporte').value = data.transporte;
                document.getElementById('prod-carregamento').value = data.carregamento;
                calcularProducao();
                alert('‚úÖ Configura√ß√£o carregada com sucesso!');
            } else {
                alert('‚ùå Nenhuma configura√ß√£o salva encontrada.');
            }
        }

        // =====================================
        // C√ÅLCULOS DE FRETE
        // =====================================

        function calcularFrete() {
            const distancia = parseFloat(document.getElementById('frete-distancia').value) || 150;
            const volume = parseFloat(document.getElementById('frete-volume').value) || 100;
            const custoKm = parseFloat(document.getElementById('frete-custo-km').value) || 4.50;
            const caminhao = document.getElementById('frete-caminhao').value;

            // Capacidades por caminh√£o
            const capacidades = {
                'truck': 14,
                'carreta': 28,
                'bitrem': 45
            };

            const capacidade = capacidades[caminhao];
            const numViagens = Math.ceil(volume / capacidade);
            const custoViagem = distancia * custoKm;
            const pedagios = distancia * 1.0; // R$ 1,00/km estimado
            const custoBase = custoViagem * numViagens;
            const custoTotal = custoBase + (pedagios * numViagens);
            const seguro = custoTotal * 0.02;
            const custoTotalFinal = custoTotal + seguro;
            const custoM3 = custoTotalFinal / volume;

            // Calcular diesel
            const consumo = 2.5; // km/L
            const litros = (distancia * numViagens) / consumo;
            const custoDiesel = litros * 6.20;

            // Tempo estimado
            const velocidadeMedia = 60; // km/h
            const tempoHoras = distancia / velocidadeMedia;
            const horas = Math.floor(tempoHoras);
            const minutos = Math.round((tempoHoras - horas) * 60);

            // Atualizar interface
            document.getElementById('frete-dist-display').textContent = distancia;
            document.getElementById('frete-num-viagens').textContent = numViagens;
            document.getElementById('frete-custo-viagem').textContent = custoViagem.toFixed(2);
            document.getElementById('frete-pedagios').textContent = (pedagios * numViagens).toFixed(2);
            document.getElementById('frete-seguro').textContent = seguro.toFixed(2);
            document.getElementById('frete-total').textContent = custoTotalFinal.toFixed(2);
            document.getElementById('frete-custo-m3').textContent = custoM3.toFixed(2);

            document.getElementById('frete-tempo').textContent = horas + 'h ' + minutos + 'min';
            document.getElementById('frete-diesel').textContent = Math.round(litros);
            document.getElementById('frete-custo-diesel').textContent = custoDiesel.toFixed(2);
            document.getElementById('frete-eficiencia').textContent = consumo;

            // Salvar no estado
            sistemaState.frete.distancia = distancia;
            sistemaState.frete.volume = volume;
            sistemaState.frete.custoKm = custoKm;
            sistemaState.frete.custoTotal = custoTotalFinal;
            sistemaState.frete.custoM3 = custoM3;

            atualizarDashboard();
        }

        function salvarFrete() {
            localStorage.setItem('ensideFrete', JSON.stringify(sistemaState.frete));
            alert('‚úÖ C√°lculo de frete salvo com sucesso!');
        }

        function buscarMotoristasMILER() {
            alert('üöß Integra√ß√£o com sistema MILER em desenvolvimento!\n\nEm breve voc√™ poder√° buscar motoristas cadastrados diretamente do seu banco de dados.');
        }

        // =====================================
        // COTA√á√ÉO FINAL
        // =====================================

        function sincronizarDadosCotacao() {
            const prodM3 = sistemaState.producao.custoM3;
            const freteM3 = sistemaState.frete.custoM3;
            const volume = sistemaState.producao.volume;

            document.getElementById('cot-prod-m3').textContent = prodM3.toFixed(2);
            document.getElementById('cot-frete-m3').textContent = freteM3.toFixed(2);
            document.getElementById('cot-volume-display').textContent = volume;
            document.getElementById('cot-volume-display2').textContent = volume;
            document.getElementById('frete-volume').value = volume;
        }

        function calcularCotacaoFinal() {
            const prodM3 = sistemaState.producao.custoM3;
            const freteM3 = sistemaState.frete.custoM3;
            const volume = sistemaState.producao.volume;
            const baseM3 = prodM3 + freteM3;
            const baseTotal = baseM3 * volume;

            const adminPercent = parseFloat(document.getElementById('cot-admin').value) || 8;
            const impostosPercent = parseFloat(document.getElementById('cot-impostos').value) || 13.33;
            const margemPercent = parseFloat(document.getElementById('cot-margem').value) || 30;

            // C√°lculos
            const adminM3 = baseM3 * (adminPercent / 100);
            const impostosM3 = baseM3 * (impostosPercent / 100);
            const subtotal = baseM3 + adminM3 + impostosM3;
            const lucroM3 = subtotal * (margemPercent / 100);
            const precoFinalM3 = subtotal + lucroM3;

            // Totais
            const prodTotal = prodM3 * volume;
            const freteTotal = freteM3 * volume;
            const adminTotal = adminM3 * volume;
            const impostosTotal = impostosM3 * volume;
            const lucroTotal = lucroM3 * volume;
            const precoFinalTotal = precoFinalM3 * volume;

            // Percentuais sobre custo base
            const prodPercent = (prodTotal / baseTotal) * 100;
            const fretePercent = (freteTotal / baseTotal) * 100;

            // Percentuais sobre pre√ßo final
            const baseFinalPercent = (baseTotal / precoFinalTotal) * 100;
            const adminFinalPercent = (adminTotal / precoFinalTotal) * 100;
            const impostosFinalPercent = (impostosTotal / precoFinalTotal) * 100;
            const lucroFinalPercent = (lucroTotal / precoFinalTotal) * 100;

            // Indicadores
            const markup = precoFinalM3 / baseM3;
            const margemBruta = ((precoFinalM3 - baseM3) / precoFinalM3) * 100;
            const breakeven = Math.ceil(sistemaState.producao.custoTotal / lucroM3);

            // Atualizar interface - Resumo Base
            document.getElementById('cot-prod-total').textContent = prodTotal.toFixed(2);
            document.getElementById('cot-frete-total').textContent = freteTotal.toFixed(2);
            document.getElementById('cot-prod-percent').textContent = prodPercent.toFixed(1) + '%';
            document.getElementById('cot-frete-percent').textContent = fretePercent.toFixed(1) + '%';
            document.getElementById('cot-base-m3').textContent = baseM3.toFixed(2);
            document.getElementById('cot-base-total').textContent = baseTotal.toFixed(2);

            // Atualizar interface - Forma√ß√£o de Pre√ßo
            document.getElementById('cot-final-base-m3').textContent = baseM3.toFixed(2);
            document.getElementById('cot-final-base-total').textContent = baseTotal.toFixed(2);
            document.getElementById('cot-final-base-percent').textContent = baseFinalPercent.toFixed(1) + '%';

            document.getElementById('cot-final-admin-m3').textContent = adminM3.toFixed(2);
            document.getElementById('cot-final-admin-total').textContent = adminTotal.toFixed(2);
            document.getElementById('cot-final-admin-percent').textContent = adminFinalPercent.toFixed(1) + '%';

            document.getElementById('cot-final-imp-m3').textContent = impostosM3.toFixed(2);
            document.getElementById('cot-final-imp-total').textContent = impostosTotal.toFixed(2);
            document.getElementById('cot-final-imp-percent').textContent = impostosFinalPercent.toFixed(1) + '%';

            document.getElementById('cot-final-lucro-m3').textContent = lucroM3.toFixed(2);
            document.getElementById('cot-final-lucro-total').textContent = lucroTotal.toFixed(2);
            document.getElementById('cot-final-lucro-percent').textContent = lucroFinalPercent.toFixed(1) + '%';

            document.getElementById('cot-final-preco-m3').textContent = precoFinalM3.toFixed(2);
            document.getElementById('cot-final-preco-total').textContent = precoFinalTotal.toFixed(2);

            // Destaque
            document.getElementById('cot-destaque-preco').textContent = precoFinalM3.toFixed(2);
            document.getElementById('cot-destaque-total').textContent = precoFinalTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            document.getElementById('cot-destaque-volume').textContent = volume;
            document.getElementById('cot-destaque-lucro').textContent = lucroTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2});

            // Indicadores
            document.getElementById('cot-markup').textContent = markup.toFixed(2);
            document.getElementById('cot-margem-bruta').textContent = margemBruta.toFixed(1);
            document.getElementById('cot-lucro-m3').textContent = lucroM3.toFixed(2);
            document.getElementById('cot-breakeven').textContent = breakeven;

            // Salvar no estado
            sistemaState.cotacao.precoFinal = precoFinalM3;
            sistemaState.cotacao.precoTotal = precoFinalTotal;
            sistemaState.cotacao.admin = adminPercent;
            sistemaState.cotacao.impostos = impostosPercent;
            sistemaState.cotacao.margem = margemPercent;

            atualizarDashboard();
        }

        function salvarCotacao() {
            localStorage.setItem('ensideCotacao', JSON.stringify(sistemaState));
            alert('‚úÖ Cota√ß√£o completa salva com sucesso!');
        }

        function exportarCotacaoCSV() {
            const volume = sistemaState.producao.volume;
            const prodM3 = sistemaState.producao.custoM3;
            const freteM3 = sistemaState.frete.custoM3;
            const precoM3 = sistemaState.cotacao.precoFinal;

            let csv = 'Componente,Valor/m¬≥,Total\n';
            csv += `Produ√ß√£o,${prodM3.toFixed(2)},${(prodM3 * volume).toFixed(2)}\n`;
            csv += `Frete,${freteM3.toFixed(2)},${(freteM3 * volume).toFixed(2)}\n`;
            csv += `Pre√ßo Final,${precoM3.toFixed(2)},${(precoM3 * volume).toFixed(2)}\n`;

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cotacao_enside_' + new Date().toISOString().slice(0,10) + '.csv';
            a.click();
        }

        // =====================================
        // PROPOSTA COMERCIAL
        // =====================================

        function gerarProposta() {
            // Pegar dados do formul√°rio
            const clienteNome = document.getElementById('prop-cliente-nome').value || '[Nome do Cliente]';
            const clienteContato = document.getElementById('prop-cliente-contato').value || '[Nome do Contato]';
            const clienteEmail = document.getElementById('prop-cliente-email').value || '[email@cliente.com]';
            const clienteTelefone = document.getElementById('prop-cliente-telefone').value || '[(00) 0000-0000]';
            const clienteCidade = document.getElementById('prop-cliente-cidade').value || '[Cidade - UF]';
            const validade = document.getElementById('prop-validade').value || 15;

            // Gerar n√∫mero e data da proposta
            const hoje = new Date();
            const numeroProposta = hoje.getFullYear() + '-' + String(Math.floor(Math.random() * 9999)).padStart(4, '0');
            const dataProposta = hoje.toLocaleDateString('pt-BR');

            // Preencher dados do cliente
            document.getElementById('prop-numero').textContent = numeroProposta;
            document.getElementById('prop-data').textContent = dataProposta;
            document.getElementById('prop-display-cliente').textContent = clienteNome;
            document.getElementById('prop-display-contato').textContent = clienteContato;
            document.getElementById('prop-display-email').textContent = clienteEmail;
            document.getElementById('prop-display-telefone').textContent = clienteTelefone;
            document.getElementById('prop-display-cidade').textContent = clienteCidade;
            document.getElementById('prop-display-validade').textContent = validade;
            document.getElementById('prop-footer-validade').textContent = validade;

            // Preencher dados t√©cnicos
            document.getElementById('prop-display-volume').textContent = sistemaState.producao.volume;

            const origens = {
                'paraibuna-sp': 'Paraibuna (SP/MG)',
                'norte-pr': 'Norte do Paran√°',
                'oeste-sc': 'Oeste de Santa Catarina'
            };
            const origem = document.getElementById('frete-origem').value;
            document.getElementById('prop-display-origem').textContent = origens[origem] || origem;

            const destinos = {
                'sao-paulo-sp': 'S√£o Paulo Capital',
                'campinas-sp': 'Campinas (SP)',
                'rio-rj': 'Rio de Janeiro (RJ)',
                'curitiba-pr': 'Curitiba (PR)',
                'belo-horizonte-mg': 'Belo Horizonte (MG)'
            };
            const destino = document.getElementById('frete-destino').value;
            document.getElementById('prop-display-destino').textContent = destinos[destino] || destino;

            // Preencher tabela de valores
            const volume = sistemaState.producao.volume;
            const prodM3 = sistemaState.producao.custoM3;
            const freteM3 = sistemaState.frete.custoM3;
            const precoM3 = sistemaState.cotacao.precoFinal;

            const adminM3 = parseFloat(document.getElementById('cot-final-admin-m3').textContent);
            const impM3 = parseFloat(document.getElementById('cot-final-imp-m3').textContent);
            const adminImpM3 = adminM3 + impM3;

            document.getElementById('prop-table-prod').textContent = prodM3.toFixed(2);
            document.getElementById('prop-table-prod-total').textContent = (prodM3 * volume).toLocaleString('pt-BR', {minimumFractionDigits: 2});

            document.getElementById('prop-table-frete').textContent = freteM3.toFixed(2);
            document.getElementById('prop-table-frete-total').textContent = (freteM3 * volume).toLocaleString('pt-BR', {minimumFractionDigits: 2});

            document.getElementById('prop-table-admin').textContent = adminImpM3.toFixed(2);
            document.getElementById('prop-table-admin-total').textContent = (adminImpM3 * volume).toLocaleString('pt-BR', {minimumFractionDigits: 2});

            document.getElementById('prop-table-final').textContent = precoM3.toFixed(2);
            document.getElementById('prop-table-final-total').textContent = (precoM3 * volume).toLocaleString('pt-BR', {minimumFractionDigits: 2});

            // Mostrar proposta
            document.getElementById('proposta-container').style.display = 'block';
            document.getElementById('proposta-actions').style.display = 'flex';

            // Scroll suave para a proposta
            document.getElementById('proposta-container').scrollIntoView({ behavior: 'smooth' });
        }

        function imprimirProposta() {
            window.print();
        }

        function gerarPropostaPDF() {
            alert('üìÑ Gerando PDF...\n\nUse a fun√ß√£o de impress√£o do navegador e selecione "Salvar como PDF".');
            window.print();
        }

        function enviarPropostaEmail() {
            const email = document.getElementById('prop-cliente-email').value;
            const assunto = 'Proposta Comercial - Enside Madeiras';
            const corpo = 'Segue em anexo nossa proposta comercial para fornecimento de madeira de eucalipto.';

            window.location.href = `mailto:${email}?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(corpo)}`;
        }

        function enviarPropostaWhatsApp() {
            const telefone = document.getElementById('prop-cliente-telefone').value.replace(/\D/g, '');
            const mensagem = `Ol√°! Segue nossa proposta comercial para fornecimento de ${sistemaState.producao.volume}m¬≥ de madeira de eucalipto.\n\nValor: R$ ${sistemaState.cotacao.precoFinal.toFixed(2)}/m¬≥\nTotal: R$ ${sistemaState.cotacao.precoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2})}\n\nConfira todos os detalhes no documento em anexo.`;

            window.open(`https://wa.me/55${telefone}?text=${encodeURIComponent(mensagem)}`);
        }

        // =====================================
        // DASHBOARD
        // =====================================

        function atualizarDashboard() {
            const prodM3 = sistemaState.producao.custoM3;
            const freteM3 = sistemaState.frete.custoM3;
            const totalM3 = prodM3 + freteM3;
            const precoM3 = sistemaState.cotacao.precoFinal;
            const volume = sistemaState.producao.volume;
            const lucroM3 = precoM3 - totalM3;
            const margemPercent = ((lucroM3 / precoM3) * 100);
            const lucroTotal = lucroM3 * volume;

            // Atualizar cards
            document.getElementById('dash-custo-producao').textContent = prodM3.toFixed(2);
            document.getElementById('dash-custo-frete').textContent = freteM3.toFixed(2);
            document.getElementById('dash-custo-total').textContent = totalM3.toFixed(2);
            document.getElementById('dash-preco-venda').textContent = precoM3.toFixed(2);
            document.getElementById('dash-margem').textContent = margemPercent.toFixed(1);
            document.getElementById('dash-lucro').textContent = lucroTotal.toLocaleString('pt-BR', {minimumFractionDigits: 0});

            // Atualizar fluxo
            document.getElementById('flow-producao').textContent = prodM3.toFixed(2);
            document.getElementById('flow-frete').textContent = freteM3.toFixed(2);
            document.getElementById('flow-margem').textContent = margemPercent.toFixed(1);
            document.getElementById('flow-venda').textContent = precoM3.toFixed(2);
        }

        // =====================================
        // INICIALIZA√á√ÉO
        // =====================================

        document.addEventListener('DOMContentLoaded', function() {
            // Carregar dados salvos se existirem
            const savedProd = localStorage.getItem('ensideProducao');
            const savedFrete = localStorage.getItem('ensideFrete');
            const savedCotacao = localStorage.getItem('ensideCotacao');

            if (savedProd) {
                const data = JSON.parse(savedProd);
                document.getElementById('prod-volume').value = data.volume;
                document.getElementById('prod-planejamento').value = data.planejamento;
                document.getElementById('prod-corte').value = data.corte;
                document.getElementById('prod-transporte').value = data.transporte;
                document.getElementById('prod-carregamento').value = data.carregamento;
            }

            // Calcular valores iniciais
            calcularProducao();
            calcularFrete();
            atualizarDashboard();

            console.log('‚úÖ Sistema Integrado Enside Madeiras carregado com sucesso!');
        });
    </script>
</body>
</html>
